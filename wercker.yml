box: wercker/android
# Build definition
build:
  # The steps that will be executed on build
  steps:
    - wercker/setup-android-emulator@0.0.8:
      target: android-18
    - script:
        name: show base information
        code: |
          gradle -v
          echo $ANDROID_HOME
          echo $ANDROID_BUILD_TOOLS
          echo $ANDROID_UPDATE_FILTER
    # A step that executes `gradle build` command
    - script:
        name: run gradle
        code: |
          gradle --full-stacktrace -q --project-cache-dir=$WERCKER_CACHE_DIR build
  after-steps:
    # Use the build results
    - script:
        name: inspect build result
        code: |
          ls -la app/build/outputs/apk/
          cp app/build/outputs/apk/*.apk $WERCKER_REPORT_ARTIFACTS_DIR
          echo $WERCKER_REPORT_ARTIFACTS_DIR
          echo $WERCKER_GIT_COMMIT
          echo $WERCKER_GIT_BRANCH
          ls -la $WERCKER_REPORT_ARTIFACTS_DIR
deploy:
  steps:
    - script:
       name: hockeyapp
       code: >
        ls -la;

        RESULT=$(
        curl
        -F status=2
        -F notify=0
        -F notes="Deploy to HockeyApp"
        -F notes_type=0
        -F ipa=@app/build/outputs/apk/app-debug.apk
        -H "X-HockeyAppToken: 1b806ddf85974542bf9e5120617b3a26"
        https://rink.hockeyapp.net/api/2/apps/c271311c8e47372fb375a43f8bc5a30f/app_versions/upload)

        echo $RESULT;

        if [[ $RESULT == *"appsize"* ]]; then
        echo "Apk file has been successfully uploaded";
        else
        exit 1;
        fi;
          ls -la .
          cp app/build/outputs/apk/*.apk $WERCKER_REPORT_ARTIFACTS_DIR
