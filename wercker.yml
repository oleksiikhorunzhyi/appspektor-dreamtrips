box: man4ik/android
# Build definition
build:
  # The steps that will be executed on build
  steps:
    - script:
        name: show base information
        code: |
          android list targets
          android list sdk --all --extended
          gradle -v
          echo $ANDROID_HOME
          echo $ANDROID_BUILD_TOOLS
          echo $ANDROID_UPDATE_FILTER
#    - setup-android-emulator:
#        target: 1
    - script:
        name: run gradle connectedCheck
        code: |
          gradle test --stacktrace --info
    - script:
        name: run gradle build
        code: |
          gradle build --stacktrace --info --no-color -q
  after-steps:
    # Use the build results
    - script:
        name: inspect build result
        code: |
          ls -la app/build/outputs/apk/
          cp app/build/outputs/apk/*.apk $WERCKER_REPORT_ARTIFACTS_DIR
deploy:
  steps:
    - script:
       name: hockeyapp
       code: |
        BRANCH=$(git branch | awk '/^\*/{print $2}')
        echo $BRANCH #if [ "$BRANCH" == "master" ]
        curl \
           -F status=2 \
           -F notify=0 \
           -F notes=Deploy to HockeyApp \
           -F notes_type=0 \
           -F ipa=$WERCKER_REPORT_ARTIFACTS_DIR/app-debug.apk \
           -H "X-HockeyAppToken: 1b806ddf85974542bf9e5120617b3a26" \
           https://rink.hockeyapp.net/api/2/apps/c271311c8e47372fb375a43f8bc5a30f/app_versions/upload
#        fi